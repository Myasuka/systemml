#-------------------------------------------------------------
# IBM Confidential
# OCO Source Materials
# (C) Copyright IBM Corp. 2010, 2013
# The source code for this program is not published or
# otherwise divested of its trade secrets, irrespective of
# what has been deposited with the U.S. Copyright Office.
#-------------------------------------------------------------

dynRead = externalFunction(String fname, Integer rows, Integer cols, String format)
return (Matrix[Double] M) 
implemented in (classname="com.ibm.bi.dml.packagesupport.DynamicReadMatrixCP",exectype="mem")   

execCondense = externalFunction(Matrix[Double] in)
return(Matrix[Double] out)
implemented in (classname="com.ibm.bi.dml.packagesupport.RemoveEmptyRows",exectype="file", execlocation="master")   


V = read($1, rows=$2, cols=$3, format="text");   
R = matrix(0, rows=$3,cols=1); 
dummy = matrix(1, rows=1, cols=1);

parfor( i in 1:$3, mode=REMOTE_MR, opt=NONE ) 
{
   W = dynRead($1, $2, $3, "textcell");
   X = V[,i];
   sumx = sum(X);
   R[i,1] = dummy * sumx; 
}  

R = execCondense( R );

write(R, $4);       