$$readhelper$$

V = readMM("$$indir$$vector", rows=$$rows1$$, cols=1, format="text")
W = readMM("$$indir$$weight", rows=$$rows1$$, cols=1, format="text")
P = readMM("$$indir$$prob", rows=$$rows2$$, cols=1, format="text")

W = round(W)

n = nrow(V)

wt = sum(W)

# sum
s1 = sum(V*W)

# 2nd central moment
m2 = centralMoment(V, W, 2)

# 3rd central moment
m3 = centralMoment(V, W, 3)

# 4th central moment
m4 = centralMoment(V, W, 4)

# mean
mu = mean(V, W)

# variances
var = m2*wt/(wt-1.0)

# standard deviations
std_dev = sqrt(var)

# standard errors of mean
SE = std_dev/sqrt(wt)

# coefficients of variation
cv = std_dev/mu

# harmonic means (note: may generate out of memory for large sparse matrices becauses of NaNs)
har_mu = wt/(sum((1.0/V)*W))

# geometric means is not currently supported.
geom_mu = wt*exp(sum(log(V)*W)/wt)

# min and max
mn=min(V)
mx=max(V)

# range
rng = mx - mn

# Skewness
g1 = wt^2*m3/((wt-1)*(wt-2)*std_dev^3)

# standard error of skewness
se_g1=sqrt( 6*wt*(wt-1) / ((wt-2)*(wt+1)*(wt+3)) )

# Kurtosis (using binomial formula)
g2 = (wt^2*(wt+1)*m4-3*m2^2*wt^2*(wt-1))/((wt-1)*(wt-2)*(wt-3)*std_dev^4)

# Standard error of Kurtosis
se_g2= sqrt( (4*(wt^2-1)*se_g1^2)/((wt+5)*(wt-3)) )

# outliers use ppred to describe it
out_minus = ppred(V, mu-5*std_dev, "<")*V 
out_plus = ppred(V, mu+5*std_dev, ">")*V

# median
md = quantile(V, W, 0.5)

# quantile
Q = quantile(V, W, P)

# inter-quartile mean
iqm = interQuartileMean(V, W)

meanHelper=mu*Helper
stdHelper=std_dev*Helper
SEHelper=SE*Helper
varHelper=var*Helper
cvHelper=cv*Helper
harHelper=har_mu*Helper
geomHelper=geom_mu*Helper
minHelper=mn*Helper
maxHelper=mx*Helper
rngHelper=rng*Helper
g1Helper=g1*Helper
se_g1Helper=se_g1*Helper
g2Helper=g2*Helper
se_g2Helper=se_g2*Helper
medianHelper1 = md * Helper
iqmHelper = iqm * Helper

writeMM(meanHelper, "$$outdir$$mean_weight", format="text");
writeMM(stdHelper, "$$outdir$$std_weight", format="text");
writeMM(SEHelper, "$$outdir$$se_weight", format="text");
writeMM(varHelper, "$$outdir$$var_weight", format="text");
writeMM(cvHelper, "$$outdir$$cv_weight", format="text");
writeMM(harHelper, "$$outdir$$har_weight", format="text");
writeMM(geomHelper, "$$outdir$$geom_weight", format="text");
writeMM(minHelper, "$$outdir$$min_weight", format="text");
writeMM(maxHelper, "$$outdir$$max_weight", format="text");
writeMM(rngHelper, "$$outdir$$rng_weight", format="text");
writeMM(g1Helper, "$$outdir$$g1_weight", format="text");
writeMM(se_g1Helper, "$$outdir$$se_g1_weight", format="text");
writeMM(g2Helper, "$$outdir$$g2_weight", format="text");
writeMM(se_g2Helper, "$$outdir$$se_g2_weight", format="text");
writeMM(out_minus, "$$outdir$$out_minus_weight", format="text");
writeMM(out_plus, "$$outdir$$out_plus_weight", format="text");
writeMM(medianHelper1, "$$outdir$$median_weight", format="text");
writeMM(Q, "$$outdir$$quantile_weight", format="text");
writeMM(iqmHelper, "$$outdir$$iqm_weight", format="text");
