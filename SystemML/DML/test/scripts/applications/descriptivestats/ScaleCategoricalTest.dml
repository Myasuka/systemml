$$readhelper$$

#A <- nominal variable
#Y <- scale variable

A = read("$$indir$$A", rows=$$rows$$, cols=1, format="text");
Y = read("$$indir$$Y", rows=$$rows$$, cols=1, format="text");

# mean and variance in target variable
W = nrow(A);
my = mean(Y);
varY = centralMoment(Y,2) * W/(W-1.0)

# category-wise (frequencies, means, variances)
CFreq = groupedAggregate(target=Y, groups=A, fn="count"); 
CMeans = groupedAggregate(target=Y, groups=A, fn="mean");
CVars = groupedAggregate(target=Y, groups=A, fn="variance");

# number of categories
R = nrow(CFreq);

Eta = sqrt(1 - ( sum((CFreq-1)*CVars) / ((W-1)*varY) ));

anova_num = sum( (CFreq*(CMeans-my)^2) )/(R-1);
anova_den = sum( (CFreq-1)*CVars )/(W-R);
ANOVAF = anova_num/anova_den;

# output required statistics
varYHelper = varY * Helper;
write(varYHelper, "$$outdir$$outVarY", format="text");

myHelper = my * Helper;
write(myHelper, "$$outdir$$outMeanY", format="text");

write(CFreq, "$$outdir$$outCatFreqs", format="text");
write(CMeans, "$$outdir$$outCatMeans", format="text");
write(CVars, "$$outdir$$outCatVars", format="text");

EtaHelper = Eta * Helper;
write(EtaHelper, "$$outdir$$outEta", format="text");

AnovaFHelper = ANOVAF * Helper;
write(AnovaFHelper, "$$outdir$$outAnovaF", format="text");


