#-------------------------------------------------------------
# IBM Confidential
# OCO Source Materials
# (C) Copyright IBM Corp. 2010, 2013
# The source code for this program is not published or
# otherwise divested of its trade secrets, irrespective of
# what has been deposited with the U.S. Copyright Office.
#-------------------------------------------------------------

 
	x=read("$$indir$$x", rows=5, cols=5, format="text") ;
	y=read("$$indir$$y", rows=5, cols=5, format="text") ;
	z=read("$$indir$$z", rows=5, cols=5, format="text") ;
	
	#zrow = nrow(z);
	zrow = 5;
	numtopics = 5;
	wd = Rand(rows = zrow, cols = numtopics) ;
	
	#zcol = ncol(z)
	zcol = 5;
	hd = Rand(rows = numtopics, cols=zcol) ;
	
	accuracy = 0.000001
	continue = true
	zerror = z - wd %*% hd
	newObj = sum(zerror * zerror)
	
	max_iteration = 10
	i = 0
	while (continue == true & i < max_iteration) {
  		hd = hd * ((t(wd) %*% z) /  ( (t(wd) %*% wd) %*% hd))
  		wd = wd * ((z %*% t(hd)) / ( wd %*% (hd %*% t(hd))))
		i = i + 1
		
		# Convergence test begin
		oldObj = newObj
  		derror = z - wd %*% hd
  		newObj = sum(derror * derror)
  		continue = (newObj-oldObj) > (oldObj * accuracy)
	}
	
	xrow = nrow(x)
	wb = Rand(rows = xrow, cols = numtopics) ;
	
	i = 0
	while (i < max_iteration) {
  		wb = wb * ((x %*% t(hd)) / ( wb %*% (hd %*% t(hd))))
  		i = i + 1
	}
	
	ycol = ncol(y)
	hc = Rand(rows = numtopics, cols = ycol)
	
	i = 0
	while (i < max_iteration) {
		hc = hc * ((t(wd) %*% y) /  ( (t(wd) %*% wd) %*% hc))
		i = i + 1
	}
	write (wb,"$$outdir$$nmf.wb.result", format="binary");
	write (hc,"$$outdir$$nmf.hc.result", format="binary");
	