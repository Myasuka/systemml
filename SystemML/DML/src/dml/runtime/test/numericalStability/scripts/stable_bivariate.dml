Y = read($2, rows=$4, cols=1, rows_per_block=$9, cols_per_block=1, format="binary");
A = read($3, rows=$4, cols=1, rows_per_block=$9, cols_per_block=1, format="binary");

W = $4;

m2Y = centralMoment(Y,2);

accmvarY = m2Y * W
my = sum(Y)/W;

CFreq = ctable(A,1); # groupedAggregate(target=Y, groups=A, fn="count"); # 
R = nrow(CFreq);

accumCVars = groupedAggregate(target=Y, groups=A, fn="centralmoment", order=2)*CFreq;
CMeans = groupedAggregate(target=Y, groups=A, fn="mean");
sumAccumCVars=sum(accumCVars)

anova_num = sum( CFreq*( (CMeans-my)^2 ) )/(R-1.0)

intermediate= 1-sumAccumCVars/accmvarY;

Eta = sqrt(intermediate)
anova_den = sumAccumCVars/(W-R);
ANOVAF = anova_num/anova_den;

Helper=Rand(rows = 1, cols = 1, min = 1, max = 1);
EtaHelper=Eta*Helper
ANOVAFHelper=ANOVAF*Helper

write(EtaHelper, $6, format="binary");
write(ANOVAFHelper, $7, format="binary");

